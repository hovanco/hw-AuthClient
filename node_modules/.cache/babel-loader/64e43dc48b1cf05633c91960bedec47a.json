{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/AuthClient/src/features/auth/components/form-bottom/FormBottom.tsx\",\n    _s = $RefreshSig$();\n\nimport { message } from 'antd';\nimport { get } from 'lodash';\nimport * as queryString from 'query-string';\nimport React from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { connectFanpageApi } from '../../../../api';\nimport { loginActionWithService } from '../../../../api/auth';\nimport { setToken } from '../../../../api/token';\nimport LoginFacebookBtn from '../../../../components/login-facebook';\nimport { STORE_URL } from '../../../../constants';\nimport { getStoreId } from '../../utils';\nimport './form-bottom.less';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst FormBottom = ({\n  title,\n  showSocialLogin = true\n}) => {\n  _s();\n\n  const history = useHistory();\n  const searchState = queryString.parse(history.location.search);\n\n  const redirectAppPage = async ({\n    token,\n    noStore\n  }) => {\n    const params = {\n      token: JSON.stringify(token),\n      remember: true,\n      location: noStore || !searchState.url ? '/' : searchState.location,\n      isHasStore: !noStore\n    };\n    const search = queryString.stringify(params);\n\n    if (noStore || !searchState.url) {\n      window.location.href = `${STORE_URL}?${search}`;\n    } else {\n      window.location.href = `${searchState.url}?${search}`;\n    }\n  };\n\n  const handleSocialLogin = async (response, service) => {\n    const {\n      accessToken\n    } = response;\n\n    if (accessToken) {\n      const responseLogin = await loginActionWithService({\n        accessToken\n      }, service);\n\n      if (get(responseLogin, 'accessToken')) {\n        await setToken({\n          token: responseLogin,\n          remember: true\n        });\n        const storeId = await getStoreId(responseLogin);\n\n        if (!storeId) {\n          redirectAppPage({\n            token: responseLogin,\n            noStore: true\n          });\n        } else {\n          await connectFanpageApi({\n            payload: {\n              shortLiveToken: accessToken\n            },\n            storeId,\n            token: get(responseLogin, 'accessToken')\n          });\n          redirectAppPage({\n            token: responseLogin,\n            noStore: false\n          });\n        }\n      }\n    } else {\n      message.error('Đăng ký không thành công.');\n    }\n  };\n\n  const loginFacebook = data => {\n    handleSocialLogin(data, 'facebook');\n  };\n\n  const loginGoogle = data => {\n    handleSocialLogin(data, 'google');\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"content-another-sign-up\",\n      children: title\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }, this), showSocialLogin && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"form-header-social\",\n      children: /*#__PURE__*/_jsxDEV(LoginFacebookBtn, {\n        loginFacebook: loginFacebook\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 9\n  }, this);\n};\n\n_s(FormBottom, \"9cZfZ04734qoCGIctmKX7+sX6eU=\", false, function () {\n  return [useHistory];\n});\n\n_c = FormBottom;\nexport default FormBottom;\n\nvar _c;\n\n$RefreshReg$(_c, \"FormBottom\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/AuthClient/src/features/auth/components/form-bottom/FormBottom.tsx"],"names":["message","get","queryString","React","useHistory","connectFanpageApi","loginActionWithService","setToken","LoginFacebookBtn","STORE_URL","getStoreId","FormBottom","title","showSocialLogin","history","searchState","parse","location","search","redirectAppPage","token","noStore","params","JSON","stringify","remember","url","isHasStore","window","href","handleSocialLogin","response","service","accessToken","responseLogin","storeId","payload","shortLiveToken","error","loginFacebook","data","loginGoogle"],"mappings":"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","sourcesContent":["import { message } from 'antd';\nimport { get } from 'lodash';\nimport * as queryString from 'query-string';\nimport React, { FC } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport { connectFanpageApi } from '../../../../api';\nimport { loginActionWithService } from '../../../../api/auth';\nimport { IToken, setToken } from '../../../../api/token';\nimport LoginFacebookBtn from '../../../../components/login-facebook';\nimport LoginGoogleBtn from '../../../../components/login-google';\nimport { STORE_URL } from '../../../../constants';\nimport { getStoreId } from '../../utils';\nimport './form-bottom.less';\n\ninterface Props {\n    title: string;\n    showSocialLogin?: boolean;\n}\n\nconst FormBottom: FC<Props> = ({ title, showSocialLogin = true }) => {\n    const history = useHistory();\n\n    const searchState: {\n        url?: string;\n        location?: string;\n        isLogout?: string;\n    } = queryString.parse(history.location.search);\n\n    const redirectAppPage = async ({\n        token,\n        noStore,\n    }: {\n        token: IToken;\n        noStore: boolean;\n    }) => {\n        const params = {\n            token: JSON.stringify(token),\n            remember: true,\n            location: noStore || !searchState.url ? '/' : searchState.location,\n            isHasStore: !noStore,\n        };\n\n        const search = queryString.stringify(params);\n\n        if (noStore || !searchState.url) {\n            window.location.href = `${STORE_URL}?${search}`;\n        } else {\n            window.location.href = `${searchState.url}?${search}`;\n        }\n    };\n\n    const handleSocialLogin = async (\n        response: any,\n        service?: string,\n    ): Promise<any> => {\n        const { accessToken } = response;\n        if (accessToken) {\n            const responseLogin = await loginActionWithService(\n                { accessToken },\n                service,\n            );\n\n            if (get(responseLogin, 'accessToken')) {\n                await setToken({\n                    token: responseLogin as IToken,\n                    remember: true,\n                });\n\n                const storeId = await getStoreId(responseLogin);\n\n                if (!storeId) {\n                    redirectAppPage({ token: responseLogin, noStore: true });\n                } else {\n                    await connectFanpageApi({\n                        payload: { shortLiveToken: accessToken },\n                        storeId,\n                        token: get(responseLogin, 'accessToken'),\n                    });\n                    redirectAppPage({ token: responseLogin, noStore: false });\n                }\n            }\n        } else {\n            message.error('Đăng ký không thành công.');\n        }\n    };\n\n    const loginFacebook = (data: any) => {\n        handleSocialLogin(data, 'facebook');\n    };\n\n    const loginGoogle = (data: any) => {\n        handleSocialLogin(data, 'google');\n    };\n\n    return (\n        <div>\n            <p className=\"content-another-sign-up\">{title}</p>\n            {showSocialLogin && (\n                <div className=\"form-header-social\">\n                    <LoginFacebookBtn loginFacebook={loginFacebook} />\n                    {/* <LoginGoogleBtn loginGoogle={loginGoogle} /> */}\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default FormBottom;\n"]},"metadata":{},"sourceType":"module"}